"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5885],{28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>a});var s=r(296540);const i={},o=s.createContext(i);function c(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(o.Provider,{value:n},e.children)}},110426:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Devs/instalacion/configuracion_ssl_cloudflare","title":"SSL Automatico","description":"Este documento detalla el proceso para generar y renovar certificados","source":"@site/versioned_docs/version-Pro7/Devs/instalacion/configuracion_ssl_cloudflare.md","sourceDirName":"Devs/instalacion","slug":"/Devs/instalacion/configuracion_ssl_cloudflare","permalink":"/Pro7/Devs/instalacion/configuracion_ssl_cloudflare","draft":false,"unlisted":false,"editUrl":"https://github.com/fastura/documentacion/tree/main/versioned_docs/version-Pro7/Devs/instalacion/configuracion_ssl_cloudflare.md","tags":[],"version":"Pro7","lastUpdatedBy":"zjceo","lastUpdatedAt":1761882329000,"sidebarPosition":7,"frontMatter":{"title":"SSL Automatico","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Migrar a Pro7.1 o Superior","permalink":"/Pro7/Devs/instalacion/Upgrade-Docs"},"next":{"title":"Mozo en cPanel","permalink":"/Pro7/Devs/instalacion/Instalacion-Mozo-cPanel"}}');var i=r(474848),o=r(28453);const c={title:"SSL Automatico",sidebar_position:7},a="\ud83c\udf10 Configuraci\xf3n SSL con Cloudflare + Certbot + Docker",l={},d=[{value:"\ud83d\udccb Prerequisitos",id:"-prerequisitos",level:2},{value:"\ud83e\udde9 1. Instalaci\xf3n de dependencias",id:"-1-instalaci\xf3n-de-dependencias",level:2},{value:"\u2699\ufe0f 2. Archivo de configuraci\xf3n Cloudflare",id:"\ufe0f-2-archivo-de-configuraci\xf3n-cloudflare",level:2},{value:"\ud83d\udd10 3. Generar el certificado SSL",id:"-3-generar-el-certificado-ssl",level:2},{value:"\ud83d\udcc2 4. Copiar los certificados",id:"-4-copiar-los-certificados",level:2},{value:"\ud83e\uddf0 5. Aplicar cambios dentro del contenedor",id:"-5-aplicar-cambios-dentro-del-contenedor",level:2},{value:"\ud83d\udd01 6. Reiniciar el proxy",id:"-6-reiniciar-el-proxy",level:2},{value:"\u23f0 7. Automatizar la renovaci\xf3n con CRON",id:"-7-automatizar-la-renovaci\xf3n-con-cron",level:2},{value:"\ud83e\udde0 8. Prueba de renovaci\xf3n (opcional)",id:"-8-prueba-de-renovaci\xf3n-opcional",level:2},{value:"\u2705 Resultado esperado",id:"-resultado-esperado",level:2},{value:"\ud83d\udcce Anexo: Obtener Token Cloudflare",id:"-anexo-obtener-token-cloudflare",level:2}];function t(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-configuraci\xf3n-ssl-con-cloudflare--certbot--docker",children:"\ud83c\udf10 Configuraci\xf3n SSL con Cloudflare + Certbot + Docker"})}),"\n",(0,i.jsxs)(n.p,{children:["Este documento detalla el proceso para generar y renovar certificados\nSSL con ",(0,i.jsx)(n.strong,{children:"Let's Encrypt (Certbot)"})," usando el plugin ",(0,i.jsx)(n.strong,{children:"Cloudflare DNS"}),",\naplicarlos a tu contenedor Docker y automatizar su renovaci\xf3n."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-prerequisitos",children:"\ud83d\udccb Prerequisitos"}),"\n",(0,i.jsx)(n.p,{children:"Antes de comenzar, aseg\xfarate de tener:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Token de Cloudflare"})," con permisos de edici\xf3n de DNS","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"configuracion_ssl_cloudflare#-anexo-obtener-token-cloudflare",children:"Ver c\xf3mo obtener tu token de Cloudflare \u2192"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Acceso SSH a tu servidor"}),"\n",(0,i.jsx)(n.li,{children:"Docker y Docker Compose instalados"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-1-instalaci\xf3n-de-dependencias",children:"\ud83e\udde9 1. Instalaci\xf3n de dependencias"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install -y python3-certbot-dns-cloudflare\nsudo apt install -y cron\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-2-archivo-de-configuraci\xf3n-cloudflare",children:"\u2699\ufe0f 2. Archivo de configuraci\xf3n Cloudflare"}),"\n",(0,i.jsx)(n.p,{children:"Creamos el archivo de credenciales:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/letsencrypt/<dominio>_cloudflare.ini\n"})}),"\n",(0,i.jsx)(n.p,{children:"Contenido del archivo:"}),"\n",(0,i.jsx)(n.p,{children:"dns_cloudflare_api_token = $CLOUDFLARE_TOKEN"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u26a0\ufe0f Protege el archivo para que solo root pueda leerlo:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo chmod 600 /etc/letsencrypt/<dominio>_cloudflare.ini\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-3-generar-el-certificado-ssl",children:"\ud83d\udd10 3. Generar el certificado SSL"}),"\n",(0,i.jsx)(n.p,{children:"Ejecuta el siguiente comando reemplazando las variables por tu dominio y\ncorreo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo certbot certonly   --dns-cloudflare   --dns-cloudflare-credentials /etc/letsencrypt/<dominio>_cloudflare.ini   -d <dominio> -d "*.<dominio>"   --agree-tos --no-eff-email   --server https://acme-v02.api.letsencrypt.org/directory   -m <your.email@example.com>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Esto generar\xe1 los certificados en ",(0,i.jsx)(n.code,{children:"/etc/letsencrypt/live/<dominio>/"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-4-copiar-los-certificados",children:"\ud83d\udcc2 4. Copiar los certificados"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo cp /etc/letsencrypt/live/<dominio>/privkey.pem <ruta>/certs/<dominio>.key\nsudo cp /etc/letsencrypt/live/<dominio>/fullchain.pem <ruta>/certs/<dominio>.crt\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-5-aplicar-cambios-dentro-del-contenedor",children:"\ud83e\uddf0 5. Aplicar cambios dentro del contenedor"}),"\n",(0,i.jsxs)(n.admonition,{title:"Configuraci\xf3n requerida",type:"danger",children:[(0,i.jsxs)(n.p,{children:["Antes de continuar, aseg\xfarate de cambiar en el archivo ",(0,i.jsx)(n.code,{children:".env"})," del facturador el siguiente valor:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"FORCE_HTTPS=true\n"})}),(0,i.jsxs)(n.p,{children:["Esto es ",(0,i.jsx)(n.strong,{children:"obligatorio"})," para que el SSL funcione correctamente."]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker-compose exec -T fpm_<contenedor-servicio> php artisan config:cache\ndocker-compose exec -T fpm_<contenedor-servicio> php artisan cache:clear\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udca1 ",(0,i.jsx)(n.strong,{children:"Tip"}),": Si desconoces el nombre del contenedor-servicio, ejecuta el siguiente comando dentro de la carpeta del facturador:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker-compose config --services\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Esto te mostrar\xe1 la lista de servicios disponibles. Busca el que comience con ",(0,i.jsx)(n.code,{children:"fpm_"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-6-reiniciar-el-proxy",children:"\ud83d\udd01 6. Reiniciar el proxy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker restart proxy_proxy_1\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-7-automatizar-la-renovaci\xf3n-con-cron",children:"\u23f0 7. Automatizar la renovaci\xf3n con CRON"}),"\n",(0,i.jsx)(n.p,{children:"Agrega la tarea para renovar el certificado cada d\xeda a las 3 AM:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'(sudo crontab -l 2>/dev/null; echo "0 3 * * * certbot renew --quiet && docker restart proxy_proxy_1") | sudo crontab -\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-8-prueba-de-renovaci\xf3n-opcional",children:"\ud83e\udde0 8. Prueba de renovaci\xf3n (opcional)"}),"\n",(0,i.jsx)(n.p,{children:"Puedes verificar que todo est\xe9 correcto ejecutando una simulaci\xf3n:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo certbot renew --dry-run\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-resultado-esperado",children:"\u2705 Resultado esperado"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Certificados SSL emitidos y almacenados correctamente."}),"\n",(0,i.jsx)(n.li,{children:"Renovaci\xf3n autom\xe1tica configurada."}),"\n",(0,i.jsx)(n.li,{children:"Proxy Docker reiniciado autom\xe1ticamente tras cada renovaci\xf3n."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-anexo-obtener-token-cloudflare",children:"\ud83d\udcce Anexo: Obtener Token Cloudflare"}),"\n",(0,i.jsx)(n.p,{children:"Para crear tu API Token en Cloudflare:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Ingresa a tu cuenta de ",(0,i.jsx)(n.a,{href:"https://dash.cloudflare.com/",children:"Cloudflare"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Haz clic en tu icono de usuario (esquina superior derecha) \u2192 ",(0,i.jsx)(n.strong,{children:'"Mi Perfil"'})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Acceso al perfil",src:r(439893).A+"",width:"1575",height:"721"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Ve a la secci\xf3n ",(0,i.jsx)(n.strong,{children:'"Tokens de API"'})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Tokens de API",src:r(471482).A+"",width:"1575",height:"721"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Haz clic en ",(0,i.jsx)(n.strong,{children:'"Crear token"'})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Crear token",src:r(577667).A+"",width:"1599",height:"726"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Usa la plantilla ",(0,i.jsx)(n.strong,{children:'"Editar zona DNS"'})," y configura los siguientes permisos:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Configuraci\xf3n del token",src:r(199336).A+"",width:"1599",height:"724"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permisos"}),": ",(0,i.jsx)(n.code,{children:"Zona"})," \u2192 ",(0,i.jsx)(n.code,{children:"DNS"})," \u2192 ",(0,i.jsx)(n.code,{children:"Editar"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["En ",(0,i.jsx)(n.strong,{children:'"Recursos de zona"'}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Selecciona: ",(0,i.jsx)(n.code,{children:"Incluir"})," \u2192 ",(0,i.jsx)(n.code,{children:"Zona espec\xedfica"})," \u2192 Elige tu dominio"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"alt text",src:r(528268).A+"",width:"1577",height:"718"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["En ",(0,i.jsx)(n.strong,{children:'"Filtro de direcciones IP del cliente"'}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Operador"}),": Selecciona ",(0,i.jsx)(n.code,{children:"Est\xe1 en"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Valor"}),": Ingresa la IP de tu servidor VPS donde est\xe1 instalado el facturador"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"alt text",src:r(778951).A+"",width:"1577",height:"718"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["En ",(0,i.jsx)(n.strong,{children:'"TTL"'})," (Tiempo de vida del token):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Define las fechas de inicio y finalizaci\xf3n del token seg\xfan tus necesidades"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"alt text",src:r(603166).A+"",width:"1568",height:"717"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Haz clic en ",(0,i.jsx)(n.strong,{children:'"Continuar al resumen"'})," y luego ",(0,i.jsx)(n.strong,{children:'"Crear token"'})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Copia el token generado"})," y gu\xe1rdalo inmediatamente"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Importante"}),": Guarda el token en un lugar seguro. No podr\xe1s verlo nuevamente despu\xe9s de cerrar esta ventana."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},199336:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_1-ee92957eeef2115a737fc882b41f480b.png"},439893:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_4-d879cbe68c433a2bd2a19d67682684a4.png"},471482:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_3-7fb834193b51b7610461e1fb159b8198.png"},528268:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_5-227c4ba2bcdf3633ea2d1c77f92fb014.png"},577667:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_2-d111bce21073cca7add3561584c948b4.png"},603166:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_7-87cacd9655c80c7ffb0553b974c6f23f.png"},778951:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ssl_auto_6-3f0d488a52b6d9a06318fbe47426f3f0.png"}}]);