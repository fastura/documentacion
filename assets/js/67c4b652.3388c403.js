"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[81358],{340419:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"Admin/guias-adicionales/migracion-entre-servidores","title":"Migraci\xf3n de su proyecto entre servidores","description":"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro.","source":"@site/versioned_docs/version-Pro7/Admin/guias-adicionales/05-migracion-entre-servidores.md","sourceDirName":"Admin/guias-adicionales","slug":"/Admin/guias-adicionales/migracion-entre-servidores","permalink":"/documentacion/docs/Pro7/Admin/guias-adicionales/migracion-entre-servidores","draft":false,"unlisted":false,"tags":[],"version":"Pro7","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Migracion del Pro5 a Pro6","permalink":"/documentacion/docs/Pro7/Admin/guias-adicionales/migracion-pro5-pro6"},"next":{"title":"Actualizaci\xf3n","permalink":"/documentacion/docs/Pro7/actualizaci\xf3n"}}');var s=r(474848),a=r(28453);const i={},d="Migraci\xf3n de su proyecto entre servidores",t={},l=[{value:"Tener en cuenta",id:"tener-en-cuenta",level:2},{value:"Pasar datos dentro de un servidor a otro",id:"pasar-datos-dentro-de-un-servidor-a-otro",level:2},{value:"Configurar archivos",id:"configurar-archivos",level:2},{value:"Editar el archivo de docker-compose",id:"editar-el-archivo-de-docker-compose",level:3},{value:"Cambiar el puerto de FPM dentro del proxy",id:"cambiar-el-puerto-de-fpm-dentro-del-proxy",level:3},{value:"Cambiar el host de la base de datos en el .env",id:"cambiar-el-host-de-la-base-de-datos-en-el-env",level:3},{value:"Posibles errores",id:"posibles-errores",level:2},{value:"Identificar posibles errores",id:"identificar-posibles-errores",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"migraci\xf3n-de-su-proyecto-entre-servidores",children:"Migraci\xf3n de su proyecto entre servidores"})}),"\n",(0,s.jsx)(n.p,{children:"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro."}),"\n",(0,s.jsx)(n.h2,{id:"tener-en-cuenta",children:"Tener en cuenta"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"En el servidor se tiene que revisar que puertos y nombres del contenedor esta disponible para evitar conflictos."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Tener un backup de sus datos."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pasar-datos-dentro-de-un-servidor-a-otro",children:"Pasar datos dentro de un servidor a otro"}),"\n",(0,s.jsx)(n.p,{children:"Con los siguientes comandos traslada sus datos al otro servidor."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Copia los certificados del proyecto\nrsync -avzh /root/certs {ip del servidor a migrar}:/root/ \n\n# Copia el el datos del proxy del proyecto al servidor\nrsync -avzh /root/proxy {ip del servidor a migrar}:/root/              \n\n# Copia todo el proyecto al root del servidor\nrsync -avzh -q /root/ {ip del servidor a migrar}:/root/                \n\n# Copia los volumenes de la base de datos\nrsync -avzh -q /var/lib/docker/volumes/ {ip del servidor a migrar}:/var/lib/docker/volumes/ \n"})}),"\n",(0,s.jsxs)(n.p,{children:["Una vez se haya terminado la transferencia de datos, tiene que dirigrse dentro de ",(0,s.jsx)(n.code,{children:"cd /var/lib/docker/volumes/"}),", ac\xe1 se encontrar\xe1 las carpetas de mysql y redis."]}),"\n",(0,s.jsx)(n.p,{children:"Se tiene que cambiar los nombre de la carepta respecto a lo que se ha elegido previamente. Con estos comandos se puede cambiar los nombres de la carpeta."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#Se esta usando nombres de ejemplos\n# |nombre de carpeta actual | nombre de carpeta modificada |    \nmv pro6.buho.xyz_mysqldata1   pro6.buho.xyz_mysqldata2\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configurar-archivos",children:"Configurar archivos"}),"\n",(0,s.jsx)(n.p,{children:"Antes de levantar el proyecto, se tiene que configurar algunos archivos."}),"\n",(0,s.jsx)(n.h3,{id:"editar-el-archivo-de-docker-compose",children:"Editar el archivo de docker-compose"}),"\n",(0,s.jsxs)(n.p,{children:["En este ejemplo se tomar\xe1 como ejemplo que la carpeta tenga el nombre de ",(0,s.jsx)(n.strong,{children:"pro6.buho.xyz"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3\'\n\nservices:\n    nginx{numero nuevo}:\n        image: rash07/nginx\n        container_name: nginx_pro6_buho_xyz\n        working_dir: /var/www/html\n        environment:\n            VIRTUAL_HOST: pro6.buho.xyz, *.pro6.buho.xyz\n        volumes:\n            - ./:/var/www/html\n            - /root/proxy/fpms/pro6.buho.xyz:/etc/nginx/sites-available\n        restart: always\n    fpm{numero nuevo}:\n        image: rash07/php-fpm:2.0\n        container_name: fpm_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./ssh:/root/.ssh\n            - ./ssh:/var/www/.ssh\n            - ./:/var/www/html\n        restart: always\n    mariadb{numero nuevo}:\n        image: mariadb:10.5.6\n        container_name: mariadb_pro6_buho_xyz\n        environment:\n            - MYSQL_USER=\\${MYSQL_USER}\n            - MYSQL_PASSWORD=\\${MYSQL_PASSWORD}\n            - MYSQL_DATABASE=\\${MYSQL_DATABASE}\n            - MYSQL_ROOT_PASSWORD=\\${MYSQL_ROOT_PASSWORD}\n            - MYSQL_PORT_HOST=\\${MYSQL_PORT_HOST}\n        volumes:\n            - mysqldata{numero nuevo}:/var/lib/mysql\n        ports:\n            - "\\${MYSQL_PORT_HOST}:3306"\n        restart: always\n    redis{numero nuevo}:\n        image: redis:alpine\n        container_name: redis_pro6_buho_xyz\n        volumes:\n            - redisdata{numero nuevo}:/data\n        restart: always\n    scheduling{numero nuevo}:\n        image: rash07/scheduling\n        container_name: scheduling_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./:/var/www/html\n        restart: always\n    supervisor{numero nuevo}:\n        image: rash07/php7.4-supervisor\n        container_name: supervisor_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./:/var/www/html\n            - ./supervisor.conf:/etc/supervisor/conf.d/supervisor.conf\n        restart: always\n\nnetworks:\n    default:\n        external:\n            name: proxynet\n\nvolumes:\n    redisdata{numero nuevo}:\n        driver: "local"\n    mysqldata{numero nuevo}:\n        driver: "local"\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En el ejemplo de arriba, el texto de ",(0,s.jsx)(n.strong,{children:'"{numero nuevo}"'}),", se tiene que cambiar a un nombre disponible (por ejemplo ",(0,s.jsx)(n.strong,{children:"nginx12"}),") que se encunetra dentro de tu servidor. Puedes nombrar los contenedores con ",(0,s.jsx)(n.code,{children:"docker ps"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cambiar-el-puerto-de-fpm-dentro-del-proxy",children:"Cambiar el puerto de FPM dentro del proxy"}),"\n",(0,s.jsxs)(n.p,{children:["Tienes que dirigir a ",(0,s.jsx)(n.code,{children:"cd ~/proxy/fpms/{nombre de tu proyecto}/"}),", se ver\xe1 el archivo ",(0,s.jsx)(n.strong,{children:"default"}),", ingresa con ",(0,s.jsx)(n.code,{children:"nano default"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",metastring:'title="default"',children:"server {\n    listen 80 default_server;\n    root /var/www/html/public;\n    index index.html index.htm index.php;\n    server_name *._;\n    charset utf-8;\n    server_tokens off;\n    location = /favicon.ico {\n        log_not_found off;\n        access_log off;\n    }\n    location = /robots.txt {\n        log_not_found off;\n        access_log off;\n    }\n    location / {\n        try_files $uri $uri/ /index.php$is_args$args;\n    }\n    location ~ \\.php$ {\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass fpm{numero nuevo}:9000;\n        fastcgi_read_timeout 3600;\n    }\n    error_page 404 /index.php;\n    location ~ /\\.ht {\n        deny all;\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En la ",(0,s.jsx)(n.strong,{children:"fastcgi_pass"})," se tiene que cambiar con el nombre que se puso para el fpm dentro del docker-compose."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cambiar-el-host-de-la-base-de-datos-en-el-env",children:"Cambiar el host de la base de datos en el .env"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title=".env"',children:"DB_HOST={nombre del contenedor de la base dedatos}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En ",(0,s.jsx)(n.strong,{children:"DB_HOST"})," se tiene que colocar el nombre de la base de datos que lo colocaste en el docker-compose.yml."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Despu\xe9s de ello, tiene que buscar lo siguiente"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title=".env"',children:"MYSQL_PORT_HOST={puerto libre de tu vps}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Aqu\xed debes colocar un puerto libre de tu sistema para que la base de datos funcione."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"posibles-errores",children:"Posibles errores"}),"\n",(0,s.jsx)(n.h3,{id:"identificar-posibles-errores",children:"Identificar posibles errores"}),"\n",(0,s.jsxs)(n.p,{children:["Para poder ver si hay errores dentro de los contenedores, primero visualizalos con ",(0,s.jsx)(n.code,{children:"docker ps"})]}),"\n",(0,s.jsxs)(n.p,{children:["Si encuentras que dentro del rseultado, en uno de los contenedores dentro de us categor\xeda ",(0,s.jsx)(n.strong,{children:"STATUS"})," no aparece levntando (UP), entonces en ese contenedor hubo un error."]}),"\n",(0,s.jsx)(n.p,{children:"Para poder mostrar los logs del contenedor, puede usar el siguiente comando"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs --tail 20 {contenedor}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Gracias a esto podemos revisar sus registros e identificar sus posibles errores."})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var o=r(296540);const s={},a=o.createContext(s);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);